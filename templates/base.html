<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—Ç–ø—É—Å–∫–æ–≤</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="header">
        <h3 class="name-creator">Dev by –ö—É—á–µ—Ä–æ–≤–∞ –°. –í. –§–ë–ò-33</h3>
        {% if session.user_id %}
        <div class="user-menu" id="userMenu">
            <button class="user-menu-btn" id="userMenuBtn" type="button" aria-expanded="false">
                <span class="user-icon" aria-hidden="true">üë§</span>
                <span class="user-name">{{ session.full_name }}</span>
                <span class="user-caret" aria-hidden="true">‚ñæ</span>
            </button>

            <div class="user-menu-dropdown" id="userMenuDropdown">
                <a href="{{ url_for('profile') }}">–ü—Ä–æ—Ñ–∏–ª—å</a>
                <a href="{{ url_for('calendar') }}">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</a>
                {% if session.is_admin %}
                <a href="{{ url_for('admin_dashboard') }}">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                {% endif %}
                <a href="{{ url_for('logout') }}">–í—ã–π—Ç–∏</a>
            </div>
        </div>
        {% endif %}
    </div>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="flash">{{ messages[0] }}</div>
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}

    <script>
        (function () {
            const menu = document.getElementById('userMenu');
            if (!menu) return;

            const btn = document.getElementById('userMenuBtn');

            function closeMenu() {
                menu.classList.remove('open');
                btn.setAttribute('aria-expanded', 'false');
            }

            btn.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                const isOpen = menu.classList.toggle('open');
                btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
            });

            document.addEventListener('click', function (e) {
                if (!menu.contains(e.target)) closeMenu();
            });

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') closeMenu();
            });
        })();
    </script>
</body>
</html>
